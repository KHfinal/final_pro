<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="group">
	<resultMap type="group" id="groupMap">
		<result column="g_category" property="g_category" typeHandler="strArr"/>
	</resultMap>
	<select id="selectGroupList" resultMap="groupMap">
		SELECT * FROM GROUP_LIST ORDER BY G_DATE DESC
	</select>
	
	<insert id="groupInsert" parameterType="group">
  		INSERT INTO GROUP_LIST VALUES(GROUP_LIST_SEQ.NEXTVAL,#{g_name},#{g_master},#{g_intro},DEFAULT,#{g_originalFilename},#{g_renamedFilename})
  		<selectKey keyProperty="g_no" resultType="_int" order="AFTER">
  			select GROUP_LIST_SEQ.currval from dual
  		</selectKey>
  	</insert>
	
	<insert id="categoryInsert" parameterType="map">
		INSERT INTO GROUP_CATEGORY VALUES(#{g_no},#{g_category})
	</insert>
	
	<select id="groupSearch" parameterType="string" resultMap="groupMap">
		SELECT * FROM GROUP_LIST WHERE G_NAME=#{titleSearch} ORDER BY G_DATE DESC
	</select>
	
	<select id="groupFilter" parameterType="string" resultMap="groupMap">
		SELECT * FROM GROUP_LIST WHERE G_NO IN(SELECT G_NO FROM GROUP_CATEGORY WHERE C_KEY=#{category})
	</select>
	
	<select id="groupView" parameterType="_int" resultType="groupPost">
		SELECT * FROM GROUP_POST WHERE G_NO=#{groupNo} ORDER BY G_POST_DATE DESC
	</select>
	<select id="selectAttachList" parameterType="_int" resultType="groupAttach">
		SELECT G_ATTACHMENT_NO, G_POST_NO, G_ORIGINAL_FILENAME, G_RENAMED_FILENAME, G_UPLOAD_DATE FROM GROUP_ATTACHMENT JOIN GROUP_POST USING(G_POST_NO) WHERE G_NO=#{groupNo} 
	</select>
	
	<select id="selectCategory" resultType="map">
		SELECT * FROM GROUP_CATEGORY JOIN CATEGORY USING(C_KEY)
	</select>
	
	<insert id="insertGroupPost" parameterType="groupPost">
		INSERT INTO GROUP_POST VALUES(GROUP_POST_SEQ.NEXTVAL,#{g_post_contents},#{g_post_bound},#{g_no},#{g_post_writer},SYSTIMESTAMP)
		<selectKey keyProperty="g_post_no" resultType="_int" order="AFTER">
			SELECT GROUP_POST_SEQ.CURRVAL FROM DUAL
		</selectKey>
	</insert>
	<insert id="insertAttach" parameterType="groupAttach">
		INSERT INTO GROUP_ATTACHMENT VALUES(GROUP_ATTACHMENT_SEQ.NEXTVAL,#{g_post_no},#{g_original_filename},#{g_renamed_filename},SYSTIMESTAMP)
	</insert>
  
</mapper>
